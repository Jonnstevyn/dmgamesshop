<!DOCTYPE html> 

<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>D & M GamesShop</title>
        <!--Linking Font Awesome for icons-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
        <!--Linking swiper css-->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
        <link rel="stylesheet" href="ACCEPTEDUPDATE.css">
    </head>
    <body>
        <!--Header /Navbar-->
        <header>
            <nav class="navbar section-content">
                <a href="C:\Users\HomePC\Desktop\Bibliophile Domain\PINTEREST\LOGO.jpg" class="nav-logo">
                    <h2 class="logo-text">D&M GamesShop.ke</h2>
                </a>
                
                
                <button id="menu-close-button" class="fas fa-times" aria-label="Close menu"></button>
                <nav>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="#" class="nav-link">Home</a>
                        </li>
                        <li class="nav-item">
                            <a href="#menu" class="nav-link">Game Shelf</a>
                        </li>
                        <li class="nav-item">
                            <a href="#about" class="nav-link">About</a>
                        </li>
                        <li class="nav-item">
                            <a href="#testimonials" class="nav-link">How To Play</a>
                        </li>
                        
                        <li class="nav-item">
                            <a href="#contact" class="nav-link">Contact</a>
                        </li>
                    </ul>   
                </ul>
                <div class="nav-cart-sticky">
                    <a href="CART2.html" class="nav-cart-btn">
                        Cart <i class="fas fa-shopping-cart"></i>
                        <span class="cart-badge">3</span>
                    </a>
                </div>
                    
                </nav>    
                <button id="menu-open-button" class="fas fa-bars" aria-label="Open menu"></button>
            </nav>
                
        </header>

        <main>
            <!---hero section-->
            <section class="hero-section">
                <div class="section-content">
                    <div class="hero-details">
                        <h2 class="title">Discover, Play, Connect</h2>
                        <h3 class="subtitle">Your Ultimate Board and Card Games Hub!</h3>
                        <p class="description">Find your next favorite game and join a community of passionate gamers <br> <br> Whether you're a casual player or a hardcore strategist, we've got something for you!</p>
                        <div class="buttons">
                            <a href="C:\Users\HomePC\Desktop\Bibliophile Domain\HTML\BG\board games.html" target="_parent" class="button order-now">Order Now</a>
                            <a href="https:wa.me/+254746568715" target="_blank" rel="noopener" class="button contact-us" >Contact Us</a>
                            <a href="https://www.jumia.co.ke/householdsmallke/" target="_blank" rel="noopener" class="button order-jumia">Order From Jumia</a>
                        </div>
                    </div>
                    
                    
                </div>
            </section>

           <!--Menu Section-->
            <section class="menu-section" id="menu">
                <h2 class="section-title">Game Shelf</h2>
                <div id="category-nav"></div>
                <div id="menu-list"></div>
                
            </section>
            <hr>

            <!--About section-->
            <section class="about-section" id="about">
                <div class="section-content">
                    <div class="about-image-wrapper">
                        <img src="https://www.boardgameauthority.com/wp-content/uploads/2018/06/board-games-popular.jpg" alt="About" class="about-image">
                    </div>
                    <div class="about-details">
                        <h2 class="section-title">About Us</h2>
                        <p class="text">
Welcome to D&M GamesShop.ke ‚Äî where fun meets strategy and every game brings people together! <br>We‚Äôre passionate about creating memorable moments through exciting card and board games for all ages. Whether it‚Äôs game night, family time, or just good vibes, our games are designed to entertain, connect, and inspire joy.We are building a vibrant gaming culture one card, one board at a time. <br> <br>

Play, Laugh, Learn, Repeat</p>
                        <div class="social-link-list">
                            <a href="#" class="social-link" title="Facebook"><i class="fa-brands fa-facebook"></i></a>
                            <a href="https://www.instagram.com/dm_gameshop_kenya?igsh=YzIjYTk`ODg==" target="_blank" rel="noopener" class="social-link" title="Instagram"><i class="fa-brands fa-instagram"></i></a>
                            <a href="#" class="social-link" title="Twitter"><i class="fa-brands fa-x-twitter"></i></a>
                            <a href="https://wa.me/+254746568715" target="_blank" rel="noopener" class="social-link" title="WhatsApp"><i class="fa-brands fa-whatsapp"></i></a>
                            <a href="#" class="social-link" title="TikTok"><i class="fa-brands fa-tiktok"></i></a>
                        </div>
                    </div>
                </div>
            </section>
            <hr>

            <!--Testimonials section-->
            <section class="testimonials-section" id="testimonials">
                <h2 class="section-title">How To Play</h2>
                <div class="section-content">
                    <div class="slider-container swiper">
                        <div class="slider-wrapper">
                            <ul class="testimonials-list swiper-wrapper">
                                <li class="testimonial swiper-slide">
                                  <img src="https://img.lakeshorelearning.com/is/image/OCProduction/fg524?wid=800&fmt=jpeg&qlt=85,1&pscan=auto&op_sharpen=0&resMode=sharp2&op_usm=1,0.65,6,0" alt="Dominoes" class="user-image">
                                    <h3 class="name">Dominoes</h3>
                                    <i class="feedback">"One player begins by downing(playing the first tile) one of their tiles. This tile starts the line of play, a series of tiles in which adjacent tiles touch with matching values. The players alternately extend the line of play, with one tile at one of its two ends. The game ends when one player wins by playing their last tile, or when the game is blocked because neither player can play."</i>
                                </li>
                                </li>
                                <li class="testimonial swiper-slide">
                                    <img src="https://m.media-amazon.com/images/I/71cOd5YI8lL._AC_SL1500_.jpg" alt="Ludo" class="user-image">
                                    <h3 class="name">Ludo</h3>
                                    <i class="feedback">
                                        "Players take turns rolling a single die. To get a piece out of the starting base, a player must roll a six. Pieces move clockwise around the board toward their home column. If a player lands on an opponent's piece, the opponent's piece is sent back to its base. Rolling a six grants the player an extra roll. The first player to move all four of their pieces into the center home triangle wins the game."
                                    </i>
                                </li>
                                <li class="testimonial swiper-slide">
                                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSB8nQVh0qk903GHfTr26Pqse228fEJCnIB6Q&s" alt="Chess" class="user-image">
                                    <h3 class="name">Chess</h3>
                                    <i class="feedback">
                                        "The game is played on an 8x8 board. White moves first, then players alternate turns. Each piece has a unique movement pattern. The goal is to checkmate the opponent's King, meaning the King is under immediate attack (in check) and has no legal way to escape capture. If a player cannot escape checkmate, they lose the game."
                                    </i>
                                </li>
                                <li class="testimonial swiper-slide">
                                    <img src="https://m.media-amazon.com/images/I/61kA16Eb0iL._AC_SL1322_.jpg" alt="Bingo" class="user-image">
                                    <h3 class="name">Bingo</h3>
                                    <i class="feedback">
                                        "Each player receives a card with a grid of numbers under the letters B-I-N-G-O, with the center square being a free space. A caller randomly draws and announces letter-number combinations. Players cover the corresponding square on their card. The first player to cover five squares in a row‚Äîhorizontally, vertically, or diagonally‚Äîshouts 'Bingo!' to win the round."
                                    </i>
                                </li>
                                <li class="testimonial swiper-slide">
                                    <img src="https://m.media-amazon.com/images/I/819eND5NJlL.jpg" alt="Dos" class="user-image">
                                    <h3 class="name">Dos</h3>
                                    <i class="feedback">
                                        "Players are dealt seven cards and two cards are placed face-up to form a Center Row. On your turn, you play a card from your hand to match a number in the Center Row. You can match with one card or use two cards that add up to the number. The goal is to be the first to play all your cards. When you have two cards remaining, you must shout 'Dos!'"
                                    </i>
                                </li>
                                <li class="testimonial swiper-slide">
                                    <img src="https://beautifulrealizations.wordpress.com/wp-content/uploads/2013/02/jenga-1.jpg" alt="Jenga" class="user-image">
                                    <h3 class="name">Jenga</h3>
                                    <i class="feedback">
                                        "The game starts with a tower built of 54 wooden blocks, three per layer, with layers alternated in direction. Players take turns removing a single block from any level below the highest completed level and placing it on top of the tower, completing the current layer before starting a new one. The player who causes the tower to fall loses the game."
                                    </i>
                                </li>
                                <li class="testimonial swiper-slide">
                                    <img src="https://media.istockphoto.com/id/487051045/photo/scrabble-board-game.jpg?s=612x612&w=0&k=20&c=cob1XOSywaD9c7HyuXGWEIqcEnpyJoHTD5kILc4cwcQ=" alt="Scrabble" class="user-image">
                                    <h3 class="name">Scrabble</h3>
                                    <i class="feedback">
                                        "Players draw seven letter tiles and take turns forming words crossword-style on the board to score points. The first word must cover the center star square. Subsequent words must use a tile already on the board. Words are scored based on the letter values and premium squares on the board. The player with the highest score when the tiles run out wins."
                                    </i>
                                </li>
                            </ul>

                            <div class="swiper-pagination"></div>
                            <div class="swiper-slide-button swiper-button-prev"></div>
                            <div class="swiper-slide-button swiper-button-next"></div>
                        </div>
                    </div>
                </div>
            </section>

            <hr>

         

            <!--Contact Section-->
            <section class="contact-section" id="contact">
                <h2 class="section-title">Contact Us</h2>
                <div class="section-content">
                    <ul class="contact-info-list">
                        <li class="contact-info">
                            <i class="fa-solid fa-location-crosshairs"></i>
                            <p>Imenti House, Tom Mboya Street, Nairobi CBD, Shop D5</p>
                        </li>
                        <li class="contact-info">
                            <i class="fa-regular fa-envelope"></i>
                            <p>d.mgamesshop2024@gmail.com</p>
                        </li>
                        <li class="contact-info">
                            <i class="fa-solid fa-phone"></i>
                            <p>+2547 97 577 567</p>
                        </li>
                        <li class="contact-info">
                            <i class="fa-regular fa-clock"></i>
                            <p>Monday - Friday: 8:30 AM - 6:00 PM</p>
                        </li>
                        <li class="contact-info">
                            <i class="fa-regular fa-clock"></i>
                            <p>Saturday: 9:00 AM - 6:00 PM</p>
                        </li>
                        <li class="contact-info">
                            <i class="fa-regular fa-clock"></i>
                            <p>Sunday: Closed</p>
                        </li>
                        <li class="contact-info">
                            <i class="fa-solid fa-globe"></i>
                            <p>www.dnmgameshopweb.com</p>
                        </li>
                    </ul>

                    <form action="#" class="contact-form">
                         <input type="text" placeholder="Your name" class="form-input" required>
                        <input type="email" placeholder="Your email"  class="form-input" required>
                        <textarea placeholder="Your message" class="form-input" required></textarea>
                        <button type="submit" class="submit-button">Submit</button>
                    </form>
                   
                </div>
            </section>

            <!--Footer section-->
            <footer class="footer-section">
                <div class="section-content">
                    <p class="copyright-text">¬© 2025 D n M Gameshop</p>

                    <div class="social-link-list">
                         <div class="social-link-list">
                            <a href="#" class="social-link" title="Facebook"><i class="fa-brands fa-facebook"></i></a>
                            <a href="#" class="social-link" title="Instagram"><i class="fa-brands fa-instagram"></i></a>
                            <a href="#" class="social-link" title="Twitter"><i class="fa-brands fa-x-twitter"></i></a>
                            <a href="https:wa.me/+254797577567" target="_blank" rel="noopener" class="social-link" title="WhatsApp"><i class="fa-brands fa-whatsapp"></i></a>
                            <a href="#" class="social-link" title="TikTok"><i class="fa-brands fa-tiktok"></i></a>
                        </div>

                        <p class="policy-text">
                            <a href="Privacy-Policy.html" target="_parent" class="policy-link">Privacy policy</a>
                            <span class="separator">¬∑</span>
                            <a href="Refund-Policy.html" class="policy-link">Refund policy</a>
                        </p>
                    </div>
                </div>
            </footer>
        </main>

        <!--Linking Swiper Script-->
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

        <!-- ‚úÖ GOOGLE SHEETS + CART SYSTEM -->
    

   <script>
    const sheetId = "1UF8PNCYVoIO35LnDJVii0_qpzrUdxo-5tPD3lW3GP7o";
    const apiUrl = `https://opensheet.elk.sh/${sheetId}/1`;

    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    let allGames = []; // Store all games globally for filtering
    let activeTimers = {}; // Object to hold interval IDs for cleanup
    let currentCategory = 'all'; // Track the currently active category

    fetch(apiUrl)
        .then(response => response.json())
        .then(data => {
            allGames = data; 
            const menu = document.getElementById("menu-list");
            const nav = document.getElementById("category-nav");
            
            // --- 1. Process Data & Get Categories ---
            const categories = [...new Set(allGames.map(game => game.category || 'Uncategorized'))].filter(c => c !== 'Uncategorized');


            // --- 2. Generate Category Menu (Navigation) ---
            
            // FIX: Inject the Search Input first into the empty #category-nav container
            nav.innerHTML = '<input type="text" id="search-input" placeholder="Search for a game..." />';
            
            // Generate Buttons HTML
            let navHtml = `
                <button class="category-btn active" data-category="all">
                    All Games
                </button>
            `;

            navHtml += categories.map(category => `
                <button class="category-btn" data-category="${category}">
                    ${category}
                </button>
            `).join('');

            // Inject the buttons after the search bar
            nav.insertAdjacentHTML('beforeend', navHtml);
            
            // --- 3. Display All Games (Flat List - No Categories) ---
            displayGames(allGames); 
            
            
            // --- 4. Attach Event Listeners ---
            
            document.querySelectorAll(".category-btn").forEach(button => {
                button.addEventListener("click", (e) => {
                    currentCategory = e.currentTarget.getAttribute("data-category");
                    
                    // Clear active state on all buttons
                    document.querySelectorAll(".category-btn").forEach(btn => {
                        btn.classList.remove("active");
                    });

                    // Set active state on the clicked button
                    e.currentTarget.classList.add("active");
                    
                    // Clear search input when a category is clicked
                    const searchInput = document.getElementById('search-input');
                    if (searchInput) searchInput.value = '';

                    filterAndDisplayGames(); 
                });
            });

            initializeSearch(); // Initialize search logic

        })
        .catch(error => {
            console.error("Error fetching data:", error);
            document.getElementById("menu-list").innerHTML = "<p>‚ö†Ô∏è Unable to load games right now. Check your sheet ID and internet connection.</p>";
        });


    // --- 5. Helper Functions ---
    
    // NEW: Function to handle both category and search filtering
    function filterAndDisplayGames() {
        const searchInput = document.getElementById('search-input');
        const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
        
        let filteredGames = allGames;

        // 1. Filter by Category (unless a search term is present, which overrides category filtering)
        if (currentCategory !== "all" && !searchTerm) {
            filteredGames = filteredGames.filter(game => (game.category || 'Uncategorized') === currentCategory);
        } else if (currentCategory !== "all" && searchTerm) {
            // If both category is active AND searching, filter by category first
            filteredGames = filteredGames.filter(game => (game.category || 'Uncategorized') === currentCategory);
        }


        // 2. Filter by Search Term (if present)
        if (searchTerm) {
            // If searching, we always filter the current game set (which might already be category-filtered)
            filteredGames = filteredGames.filter(game => 
                (game.name || '').toLowerCase().includes(searchTerm) ||
                (game.description || '').toLowerCase().includes(searchTerm)
            );
            
            // If a search term is active, remove active class from buttons 
            // but we keep the currentCategory variable for when search is cleared.
            document.querySelectorAll(".category-btn").forEach(btn => {
                btn.classList.remove("active");
            });
        } else {
             // If search term is cleared, make sure the current category button is re-activated
            const activeButton = document.querySelector(`.category-btn[data-category="${currentCategory}"]`);
            if (activeButton) {
                activeButton.classList.add("active");
            }
        }
        
        displayGames(filteredGames);
    }
    
    // NEW: Initializes the search bar listener
    function initializeSearch() {
        const searchInput = document.getElementById('search-input');
        if (searchInput) {
            searchInput.addEventListener('input', filterAndDisplayGames);
        }
    }


    // Function to render the games (always as a flat list)
    function displayGames(gamesArray) {
        // Clear old timers before rendering new content
        Object.values(activeTimers).forEach(clearInterval);
        activeTimers = {};
        
        const menu = document.getElementById("menu-list");
        
        menu.innerHTML = gamesArray.map(generateGameCard).join('');
        
        attachCartListeners(); 
        initializeOfferTimers(); 
    }

    // Function to generate a single game HTML card (Includes Offer Logic, Ribbon, and Timer)
    function generateGameCard(game) {
        const originalPrice = parseFloat(game.price) || 0;
        const discountedPrice = parseFloat(game['on offer']) || 0;
        const offerEndsDateString = game['offer ends']; 

        const hasOffer = discountedPrice > 0 && discountedPrice < originalPrice;

        const priceForCart = hasOffer ? discountedPrice : originalPrice;

        let priceHTML = '';
        let ribbonHTML = '';
        let timerHTML = '';


        if (hasOffer) {
            const discountPercent = Math.round(((originalPrice - discountedPrice) / originalPrice) * 100);
            
            ribbonHTML = `<div class="offer-ribbon">üî• SALE! -${discountPercent}%</div>`;
            
            if (offerEndsDateString) {
                timerHTML = `<div class="offer-countdown" data-end-time="${offerEndsDateString}">Flash Sale ends in: <span class="timer-display">...</span></div>`;
            }

            priceHTML = `
                <p class="price-line sale-mode">
                    <span class="old-price">KSH ${originalPrice}</span> 
                    <span class="sale-price">KSH ${discountedPrice}</span>
                </p>
                ${timerHTML}
            `;
        } else {
            priceHTML = `<p class="price-line"><span class="regular-price">KSH ${originalPrice}</span></p>`;
        }

        return `
            <div class="menu-item fade-in" 
                 data-category="${game.category || 'All'}" 
                 data-original-price="${originalPrice}">
                ${ribbonHTML} 
                <img src="${game.image}" alt="${game.name}">
                <h3 class="product-title">${game.name || 'Unnamed Game'}</h3>
                <p class="text-card">${game.description || 'No description available.'}</p>
                ${priceHTML}
                <button class="add-to-cart" data-name="${game.name}" data-price="${priceForCart}">
                    Add to Cart
                </button>
            </div>
        `;
    }

    // NEW FUNCTION: Initializes all countdown timers
    function initializeOfferTimers() {
        const countdowns = document.querySelectorAll('.offer-countdown');

        if (countdowns.length === 0) return;

        // Function to calculate and update the time display
        function updateTimer(countdownEl, intervalId) {
            const endTimeString = countdownEl.getAttribute('data-end-time');
            const endTime = new Date(endTimeString).getTime();
            const now = new Date().getTime();
            const distance = endTime - now;

            const card = countdownEl.closest('.menu-item');
            
            // Check if the offer has expired
            if (distance <= 0) {
                const originalPrice = card.getAttribute('data-original-price');
                const button = card.querySelector('.add-to-cart');

                // 1. Revert HTML to non-sale state
                card.querySelector('.offer-ribbon')?.remove(); 
                card.querySelector('.price-line').innerHTML = `<span class="regular-price">KSH ${originalPrice}</span>`;
                countdownEl.remove(); 
                
                // 2. Revert button price (CRUCIAL)
                button.setAttribute('data-price', originalPrice);
                
                // Stop the timer
                clearInterval(intervalId);
                delete activeTimers[intervalId];
                
                return; 
            }

            // Calculate time units (D:HH:MM:SS format)
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            // Format the time string
            let timeString = '';
            if (days > 0) timeString += days + "d ";
            timeString += String(hours).padStart(2, '0') + "h:";
            timeString += String(minutes).padStart(2, '0') + "m:";
            timeString += String(seconds).padStart(2, '0') + "s";

            countdownEl.querySelector('.timer-display').textContent = timeString;
        }

        // Initialize and set interval for all active countdowns
        countdowns.forEach(countdownEl => {
            const intervalId = setInterval(() => {
                updateTimer(countdownEl, intervalId);
            }, 1000);
            
            updateTimer(countdownEl, intervalId);
            activeTimers[intervalId] = intervalId; 
        });
    }


    // Function to attach cart logic
    function attachCartListeners() {
        document.querySelectorAll(".add-to-cart").forEach(button => {
            button.onclick = () => { 
                const name = button.getAttribute("data-name");
                const price = parseFloat(button.getAttribute("data-price"));
                const existing = cart.find(item => item.name === name);

                if (existing) {
                    existing.quantity++;
                } else {
                    cart.push({ name, price, quantity: 1 });
                }

                localStorage.setItem("cart", JSON.stringify(cart));
                button.textContent = "Added ‚úì";
                setTimeout(() => button.textContent = "Add to Cart", 1500);

                updateCartBadge();
            };
        });
    }

    // UPDATE BADGE FUNCTION
    function updateCartBadge() {
        const badge = document.querySelector('.cart-badge');
        if (!badge) return;

        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

        badge.textContent = totalItems;
        badge.classList.toggle('hidden', totalItems === 0);

        badge.classList.remove('pulse');
        void badge.offsetWidth; 
        if (totalItems > 0) {
            badge.classList.add('pulse');
        }
    }

    // LISTEN FOR CART CHANGES ACROSS TABS
    window.addEventListener('storage', (e) => {
        if (e.key === 'cart') {
            cart = JSON.parse(e.newValue) || [];
            updateCartBadge();
        }
    });

    // INITIALIZE ON PAGE LOAD
    document.addEventListener('DOMContentLoaded', () => {
        cart = JSON.parse(localStorage.getItem("cart")) || [];
        updateCartBadge();
    });
    </script>

    

        

    <script src="Mumbi script.js"></script>
  </body>
</html>
