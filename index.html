<!DOCTYPE html> 

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Board Games Kenya | Buy Card Games, Puzzles & Party Fun at DM Game Shop</title>
    <meta name="description" content="Discover the best board games, card games, puzzles, and party games in Kenya. Shop online at DM Game Shop for affordable prices and fast Nairobi delivery!">
    <meta name="author" content="D&M GamesShop">
    <meta name="robots" content="index, follow">
    
    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" as="style">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" as="style">
    <link rel="preload" href="styles2.css" as="style">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <link rel="stylesheet" href="ACCEPTEDUPDATE.css">
    
    <!-- Open Graph for Facebook/Social Sharing -->
    <meta property="og:title" content="Board Games Kenya | DM Game Shop">
    <meta property="og:description" content="Buy board games, card games, and puzzles in Kenya. Affordable fun with fast delivery!">
    <meta property="og:image" content="https://dmgamesshop.co.ke/logo.png">
    <meta property="og:url" content="https://dmgamesshop.co.ke">
    <meta property="og:type" content="website">
    
    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Board Games Kenya | DM Game Shop">
    <meta name="twitter:description" content="Buy board games, card games, and puzzles in Kenya. Affordable fun with fast delivery!">
    <meta name="twitter:image" content="https://dmgamesshop.co.ke/logo.png">

    <meta name="google-site-verification" content="zsLrwNXpxLLQKL7LFyfTYJzVruP0P4sOhTgwMVPurQc" />
    
    <!-- Meta Pixel Code -->
    <script>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '1895926141326690');
        fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1895926141326690&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
    
    <!-- Schema.org -->
    <script type="application/ld+json">
        {
        "@context": "https://schema.org",
        "@type": "Store",
        "name": "DM Game Shop Kenya",
        "image": "https://dmgamesshop.co.ke/logo.png",
        "logo": "https://dmgamesshop.co.ke/logo.png",
        "url": "https://dmgamesshop.co.ke",
        "description": "Buy the best board games, card games, puzzles, and party games in Kenya. Fast delivery and affordable prices.",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Nairobi",
            "addressRegion": "Kenya",
            "addressCountry": "KE"
        },
        "sameAs": [
            "https://www.facebook.com/yourpage",
            "https://www.instagram.com/yourpage"
        ],
        "priceRange": "$$",  // Add if applicable
        "openingHours": "Mo-Su 09:00-18:00"  // Example; customize
        }
    </script>

        <!-- TikTok Pixel Code Start -->
    <script>
        !function (w, d, t) {
          w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(
        var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script")
        ;n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};
        
        
          ttq.load('D4BK9MJC77U2TCIL1KPG');
          ttq.page();
        }(window, document, 'ttq');
    </script>
        <!-- TikTok PixelÂ CodeÂ EndÂ -->
</head>
    <body>
        <!--Header /Navbar-->
        <header>
            <nav class="navbar section-content">
                <a href="C:\Users\HomePC\Desktop\Bibliophile Domain\PINTEREST\LOGO.jpg" class="nav-logo">
                    <h2 class="logo-text">D&M GamesShop</h2>
                </a>
                
                
                <button id="menu-close-button" class="fas fa-times" aria-label="Close menu"></button>
                <nav>
                    <ul class="nav-menu">
                        <li class="nav-item">
                            <a href="#" class="nav-link">Home</a>
                        </li>
                        <li class="nav-item">
                            <a href="#menu" class="nav-link">Game Shelf</a>
                        </li>
                        <li class="nav-item">
                            <a href="#about" class="nav-link">About</a>
                        </li>
                        <li class="nav-item">
                            <a href="#testimonials" class="nav-link">How To Play</a>
                        </li>
                        
                        <li class="nav-item">
                            <a href="#contact" class="nav-link">Contact</a>
                        </li>
                    </ul>   
                </ul>
                <div class="nav-cart-sticky">
                    <a href="CART2.html" class="nav-cart-btn">
                        Cart <i class="fas fa-shopping-cart"></i>
                        <span class="cart-badge">3</span>
                    </a>
                </div>
                    
                </nav>    
                <button id="menu-open-button" class="fas fa-bars" aria-label="Open menu"></button>
            </nav>
                
        </header>

        <main>
            <!---hero section-->
            <section class="hero-section">
                <div class="section-content">
                    <div class="hero-details">
                        <h2 class="title">Discover, Play, Connect</h2>
                        <h3 class="subtitle">Your Ultimate Board and Card Games Hub!</h3>
                        <p class="description">Find your next favorite game and join a community of passionate gamers <br> <br> Whether you're a casual player or a hardcore strategist, we've got something for you!</p>
                        <div class="buttons">
                            <a href="#menu" target="_parent" class="button order-now">Order Now</a>
                            <a href="#contact" target="_parent" class="button contact-us" >Contact Us</a>
                            <a href="https://www.jumia.co.ke/householdsmallke/" target="_blank" rel="noopener" class="button order-jumia">Order From Jumia</a>
                        </div>
                    </div>
                    
                    
                </div>
            </section>

           <!--Menu Section-->
            <section class="menu-section" id="menu">
                <h2 class="section-title">Game Shelf</h2>
                <div id="category-nav"></div>
                <div id="menu-list"></div>
                
            </section>
            <hr>

            <!--About section-->
            <section class="about-section" id="about">
                <div class="section-content">
                    <div class="about-image-wrapper">
                        <img src="https://www.boardgameauthority.com/wp-content/uploads/2018/06/board-games-popular.jpg" alt="About" class="about-image">
                    </div>
                    <div class="about-details">
                        <h2 class="section-title">About Us</h2>
                        <p class="text">
Welcome to D&M GamesShop.ke â€” where fun meets strategy and every game brings people together! <br>Weâ€™re passionate about creating memorable moments through exciting card and board games for all ages. Whether itâ€™s game night, family time, or just good vibes, our games are designed to entertain, connect, and inspire joy.We are building a vibrant gaming culture one card, one board at a time. <br> <br>

Play, Laugh, Learn, Repeat</p>
                        <div class="social-link-list">
                            <a href="https://www.facebook.com/share/1DU4HfvChm/" target="_blank" rel="noopener" class="social-link" title="Facebook"><i class="fa-brands fa-facebook"></i></a>
                            <a href="https://www.instagram.com/dm_gamesshop_kenya?igsh=MTN4aWUza3psZW4yOQ==" target="_blank" rel="noopener" class="social-link" title="Instagram"><i class="fa-brands fa-instagram"></i></a>
                            <a href="https://x.com/DM_Gamesshop_ke?t=yKjnkXTTZcHGOaT2Y7ZL2w&s=08" target="_blank" rel="noopener" class="social-link" title="Twitter"><i class="fa-brands fa-x-twitter"></i></a>
                            <a href="https://wa.me/+254797577567" target="_blank" rel="noopener" class="social-link" title="WhatsApp"><i class="fa-brands fa-whatsapp"></i></a>
                            <a href="https://www.tiktok.com/@dm_games.shop_ke?_t=ZM-90eyCWVl6EO&_r=1" target="_blank" rel="noopener" class="social-link" title="TikTok"><i class="fa-brands fa-tiktok"></i></a>
                        </div>
                    </div>
                </div>
            </section>
            <hr>

            <!--Testimonials section-->
            <section class="testimonials-section" id="testimonials">
                <h2 class="section-title">How To Play</h2>
                <div class="section-content">
                    <div class="slider-container swiper">
                        <div class="slider-wrapper">
                            <ul class="testimonials-list swiper-wrapper">
                                <li class="testimonial swiper-slide">
                                  <img src="https://img.lakeshorelearning.com/is/image/OCProduction/fg524?wid=800&fmt=jpeg&qlt=85,1&pscan=auto&op_sharpen=0&resMode=sharp2&op_usm=1,0.65,6,0" alt="Dominoes" class="user-image">
                                    <h3 class="name">Dominoes</h3>
                                    <i class="feedback">"One player begins by downing(playing the first tile) one of their tiles. This tile starts the line of play, a series of tiles in which adjacent tiles touch with matching values. The players alternately extend the line of play, with one tile at one of its two ends. The game ends when one player wins by playing their last tile, or when the game is blocked because neither player can play."</i>
                                </li>
                                </li>
                                <li class="testimonial swiper-slide">
                                    <img src="https://m.media-amazon.com/images/I/71cOd5YI8lL._AC_SL1500_.jpg" alt="Ludo" class="user-image">
                                    <h3 class="name">Ludo</h3>
                                    <i class="feedback">
                                        "Players take turns rolling a single die. To get a piece out of the starting base, a player must roll a six. Pieces move clockwise around the board toward their home column. If a player lands on an opponent's piece, the opponent's piece is sent back to its base. Rolling a six grants the player an extra roll. The first player to move all four of their pieces into the center home triangle wins the game."
                                    </i>
                                </li>
                                <li class="testimonial swiper-slide">
                                    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSB8nQVh0qk903GHfTr26Pqse228fEJCnIB6Q&s" alt="Chess" class="user-image">
                                    <h3 class="name">Chess</h3>
                                    <i class="feedback">
                                        "The game is played on an 8x8 board. White moves first, then players alternate turns. Each piece has a unique movement pattern. The goal is to checkmate the opponent's King, meaning the King is under immediate attack (in check) and has no legal way to escape capture. If a player cannot escape checkmate, they lose the game."
                                    </i>
                                </li>
                                <li class="testimonial swiper-slide">
                                    <img src="https://m.media-amazon.com/images/I/61kA16Eb0iL._AC_SL1322_.jpg" alt="Bingo" class="user-image">
                                    <h3 class="name">Bingo</h3>
                                    <i class="feedback">
                                        "Each player receives a card with a grid of numbers under the letters B-I-N-G-O, with the center square being a free space. A caller randomly draws and announces letter-number combinations. Players cover the corresponding square on their card. The first player to cover five squares in a rowâ€”horizontally, vertically, or diagonallyâ€”shouts 'Bingo!' to win the round."
                                    </i>
                                </li>
                                <li class="testimonial swiper-slide">
                                    <img src="https://m.media-amazon.com/images/I/819eND5NJlL.jpg" alt="Dos" class="user-image">
                                    <h3 class="name">Dos</h3>
                                    <i class="feedback">
                                        "Players are dealt seven cards and two cards are placed face-up to form a Center Row. On your turn, you play a card from your hand to match a number in the Center Row. You can match with one card or use two cards that add up to the number. The goal is to be the first to play all your cards. When you have two cards remaining, you must shout 'Dos!'"
                                    </i>
                                </li>
                                <li class="testimonial swiper-slide">
                                    <img src="https://beautifulrealizations.wordpress.com/wp-content/uploads/2013/02/jenga-1.jpg" alt="Jenga" class="user-image">
                                    <h3 class="name">Jenga</h3>
                                    <i class="feedback">
                                        "The game starts with a tower built of 54 wooden blocks, three per layer, with layers alternated in direction. Players take turns removing a single block from any level below the highest completed level and placing it on top of the tower, completing the current layer before starting a new one. The player who causes the tower to fall loses the game."
                                    </i>
                                </li>
                                <li class="testimonial swiper-slide">
                                    <img src="https://media.istockphoto.com/id/487051045/photo/scrabble-board-game.jpg?s=612x612&w=0&k=20&c=cob1XOSywaD9c7HyuXGWEIqcEnpyJoHTD5kILc4cwcQ=" alt="Scrabble" class="user-image">
                                    <h3 class="name">Scrabble</h3>
                                    <i class="feedback">
                                        "Players draw seven letter tiles and take turns forming words crossword-style on the board to score points. The first word must cover the center star square. Subsequent words must use a tile already on the board. Words are scored based on the letter values and premium squares on the board. The player with the highest score when the tiles run out wins."
                                    </i>
                                </li>
                            </ul>

                            <div class="swiper-pagination"></div>
                            <div class="swiper-slide-button swiper-button-prev"></div>
                            <div class="swiper-slide-button swiper-button-next"></div>
                        </div>
                    </div>
                </div>
            </section>

            <hr>

         

            <!--Contact Section-->
            <section class="contact-section" id="contact">
                <h2 class="section-title">Contact Us</h2>
                <div class="section-content">
                    <ul class="contact-info-list">
                        <li class="contact-info">
                            <i class="fa-solid fa-location-crosshairs"></i>
                            <p>Imenti House, Tom Mboya Street, Nairobi CBD, Shop D5</p>
                        </li>
                        <li class="contact-info">
                            <i class="fa-regular fa-envelope"></i>
                            <p>d.mgamesshop2024@gmail.com</p>
                        </li>
                        <li class="contact-info">
                            <i class="fa-brands fa-whatsapp"></i>
                            <a href="https://wa.me/+254797577567" target="_blank" rel="noopener" title="Chat on WhatsApp" class="social-link">
                                <span style="color: black; font-size: 1.12rem;">Chat with us on WhatsApp</span>
                            </a>
                        </li>
                        <li class="contact-info">
                            <i class="fa-regular fa-clock"></i>
                            <p>Monday - Friday: 8:30 AM - 6:00 PM</p>
                        </li>
                        <li class="contact-info">
                            <i class="fa-regular fa-clock"></i>
                            <p>Saturday: 9:00 AM - 6:00 PM</p>
                        </li>
                        <li class="contact-info">
                            <i class="fa-regular fa-clock"></i>
                            <p>Sunday: Closed</p>
                        </li>
                        <li class="contact-info">
                            <i class="fa-solid fa-globe"></i>
                            <p>d.mgamesshop2024@gmail.com</p>
                        </li>
                    </ul>

                    <!-- CONTACT FORM â€“ Formspree + Google Sheets (via Formspree webhook) -->
                    <form 
                        action="https://formspree.io/f/mgvnegel"
                        method="POST"
                        class="contact-form"
                        data-sheet-webhook="https://script.google.com/macros/s/AKfycbx0aGmctcdmUO14lg4WBkUEFkp9nKUfgkIoMQonMzx5iBin0Y8J5YAC4GI7668eYYqtNQ/exec">
                        
                        <input type="text" name="name" placeholder="Your name" class="form-input" required>
                        <input type="email" name="email" placeholder="Your email" class="form-input" required>
                        <textarea name="message" placeholder="Your message" class="form-input" required></textarea>
                        
                        <button type="submit" class="submit-button">Submit</button>
                    </form>
                   
                </div>
            </section>

            <!--Footer section-->
            <footer class="footer-section">
                <div class="section-content">
                    <p class="copyright-text">Â© 2025 D n M Gameshop</p>

                    <div class="social-link-list">
                         <div class="social-link-list">
                            <a href="https://www.facebook.com/share/1DU4HfvChm/" target="_blank" rel="noopener" class="social-link" title="Facebook"><i class="fa-brands fa-facebook"></i></a>
                            <a href="https://www.instagram.com/dm_gamesshop_kenya?igsh=MTN4aWUza3psZW4yOQ==" target="_blank" rel="noopener" class="social-link" title="Instagram"><i class="fa-brands fa-instagram"></i></a>
                            <a href="https://x.com/DM_Gamesshop_ke?t=yKjnkXTTZcHGOaT2Y7ZL2w&s=08" target="_blank" rel="noopener" class="social-link" title="Twitter"><i class="fa-brands fa-x-twitter"></i></a>
                            <a href="https://wa.me/+254746568715" target="_blank" rel="noopener" class="social-link" title="WhatsApp"><i class="fa-brands fa-whatsapp"></i></a>
                            <a href="https://www.tiktok.com/@dm_games.shop_ke?_t=ZM-90eyCWVl6EO&_r=1" target="_blank" rel="noopener" class="social-link" title="TikTok"><i class="fa-brands fa-tiktok"></i></a>
                        </div>
                    </div>
                        <p class="policy-text">
                            <a href="Privacy-Policy.html" target="_parent" class="policy-link">Privacy policy</a>
                            <span class="separator">Â·</span>
                            <a href="Refund-Policy.html" class="policy-link">Refund policy</a>
                        </p>
                </div>
            </footer>
        </main>


        <div id="detail-modal" class="modal">
            <div id="modal-content" class="modal-content">
            </div>
        </div>

        <!--Linking Swiper Script-->
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

        <!-- âœ… GOOGLE SHEETS + CART SYSTEM -->
    

    <script>
        /* --------------------------------------------------------------
    GAMES + BUNDLES STORE â€“ STATUS + TIMER AUTO-EXPIRE + DELIVERY INCENTIVE
    -------------------------------------------------------------- */
    const sheetId = "1UF8PNCYVoIO35LnDJVii0_qpzrUdxo-5tPD3lW3GP7o";
    const gamesApiUrl  = `https://opensheet.elk.sh/${sheetId}/1`;
    const howToPlayApiUrl = `https://opensheet.elk.sh/${sheetId}/3`;
    const bundlesApiUrl = `https://opensheet.elk.sh/${sheetId}/4`;
    const deliveryApiUrl = `https://opensheet.elk.sh/${sheetId}/5`; // NEW: Sheet 5

    let cart    = JSON.parse(localStorage.getItem("cart")) || [];
    let allGames    = [];
    let allBundles  = [];
    let activeTimers    = {};
    let currentCategory = 'all';
    let howToPlaySwiper = null;
    let deliveryText = ''; // NEW: Delivery incentive text

    /* ---------- UTILITY FUNCTIONS (NEW: Truncate Text) ---------- */
    function truncateText(text, maxLength) {
        if (!text) return '';
        if (text.length > maxLength) {
            return text.substring(0, maxLength).trim() + '...';
        }
        return text;
    }

    /* ---------- 1. LOAD GAMES + BUNDLES + DELIVERY ---------- */
    Promise.all([
    fetch(`${gamesApiUrl}?cb=${Date.now()}`, { cache: 'no-store' }).then(r => r.json()),
    fetch(`${bundlesApiUrl}?cb=${Date.now()}`, { cache: 'no-store' }).then(r => r.ok ? r.json() : []),
    fetch(`${deliveryApiUrl}?cb=${Date.now()}`, { cache: 'no-store' }).then(r => r.ok ? r.json() : [])
    ])
    .then(([gamesData, bundlesData, deliveryData]) => {
    allGames = gamesData.filter(g => g.name && g.name.trim()); // Filter out empty/invalid rows

    /* ---- FILTER + ENHANCE BUNDLES ---- */
    allBundles = bundlesData
        .filter(bundle => bundle.name && bundle.name.trim()) // Filter out empty/invalid rows
        .filter(bundle => {
        const status = (bundle.status || '').toLowerCase().trim();
        const offerEnds = bundle['offer ends'];

        if (status === 'inactive') return false;
        if (status === 'active' || !status) {
            if (!offerEnds) return true;
            const normalized = offerEnds.replace(/^(\d{1,2})\/(\d{1,2})\/(\d{4})/, '$3-$2-$1');
            const endTime = new Date(normalized).getTime();
            return endTime > Date.now();
        }
        return false;
        })
        .map(bundle => {
        const gameNames = bundle.games.split(',').map(s => s.trim());
        let total = 0;
        const images = [];

        gameNames.forEach(name => {
            const game = allGames.find(g => g.name === name);
            if (game) {
            total += parseFloat(game.price) || 0;
            if (game.image) images.push(game.image);
            }
        });

        const savings    = total - parseFloat(bundle.bundle_price);
        const ribbonText = savings > 0 ? `SAVE KSH ${savings}!` : 'SPECIAL PRICE';
        // Ensure bundle image is first, followed by included game images
        const allImages  = bundle.image ? [bundle.image, ...images] : images;

        return { ...bundle, total_price: total, savings, ribbonText, allImages };
        });

    // NEW: LOAD ALL ACTIVE DELIVERY LINES
    const activeDeliveries = deliveryData
        .filter(d => d.text && d.text.trim()) // Filter out empty/invalid rows
        .filter(d => (d.active || '').toLowerCase() === 'true')
        .map(d => d.text.trim())
        .filter(text => text);

    const incentiveElement = document.querySelector('.delivery-incentive');
    if (incentiveElement) {
        if (activeDeliveries.length > 0) {
        incentiveElement.innerHTML = '<strong>' + activeDeliveries.join('<br>') + '</strong>';
        incentiveElement.style.display = 'block';
        } else {
        incentiveElement.innerHTML = '';
        incentiveElement.style.display = 'none';
        }
    }

    initializeStore();
    loadHowToPlaySection();
    })
    .catch(err => {
    console.error("Load error:", err);
    document.getElementById("menu-list").innerHTML =
        "<p style='color:red;text-align:center;'>Failed to load store.</p>";
    });

    /* ---------- 2. BUILD NAV + FIRST DISPLAY ---------- */
    function initializeStore() {
    const nav = document.getElementById("category-nav");

    const rawGameCats = allGames.flatMap(g => 
        (g.category||'').split(',').map(c=>c.trim()).filter(c => c)
    );

    let categories = [...new Set(rawGameCats)];
    categories.sort((a, b) => a.localeCompare(b));

    if (allBundles.length > 0) {
        categories = categories.filter(cat => cat !== 'Bundles' && cat !== 'Popular Offers');
        categories.unshift('Popular Offers');
    }

    nav.innerHTML = `<input type="text" id="search-input" placeholder="Search for a game..." />`;
    let navHtml = `<button class="category-btn active" data-category="all">All Games</button>`;
    navHtml += categories.map(cat => `<button class="category-btn" data-category="${cat}">${cat}</button>`).join('');
    nav.insertAdjacentHTML('beforeend', navHtml);

    displayItems();

    document.querySelectorAll(".category-btn").forEach(btn => {
        btn.addEventListener("click", () => {
        currentCategory = btn.dataset.category;
        document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById('search-input').value = '';
        filterAndDisplayItems();
        });
    });

    document.getElementById('search-input')?.addEventListener('input', filterAndDisplayItems);
    }

    /* ---------- 3. HOW-TO-PLAY SECTION ---------- */
    function loadHowToPlaySection() {
    fetch(`${howToPlayApiUrl}?cb=${Date.now()}`, { cache: 'no-store' })
        .then(r => r.json())
        .then(data => {
        const container = document.getElementById("how-to-play-list");
        if (!container) return;

        const valid = data.filter(g => g.name && g.name.trim() && g.rules?.trim()); // Filter out empty/invalid rows
        if (!valid.length) {
            container.innerHTML = `<div class="swiper-slide"><p>No rules yet.</p></div>`;
            return;
        }

        container.innerHTML = valid.map(g => `
            <div class="swiper-slide">
            <div class="testimonial">
                <img src="${g.image||''}" alt="${g.name}" class="user-image"
                    onerror="this.src='https://via.placeholder.com/160?text=Game'">
                <h3 class="name">${g.name}</h3>
                <i class="feedback">${g.rules}</i>
            </div>
            </div>`).join('');

        if (howToPlaySwiper) setTimeout(() => howToPlaySwiper.update(), 100);
        })
        .catch(() => {
        const c = document.getElementById("how-to-play-list");
        if (c) c.innerHTML = `<div class="swiper-slide"><p>Unable to load rules.</p></div>`;
        });
    }

    /* ---------- 4. FILTER + DISPLAY ---------- */
    function filterAndDisplayItems() {
    const term = (document.getElementById('search-input')?.value||'').toLowerCase();
    let games   = allGames;
    let bundles = allBundles;

    if (currentCategory !== "all") {
        games   = games.filter(g => (g.category||'').split(',').map(c=>c.trim()).includes(currentCategory));
        bundles = currentCategory === 'Popular Offers' ? allBundles
                : allBundles.filter(b => (b.category||'').includes(currentCategory));
    }

    if (term) {
        games   = games.filter(g => g.name.toLowerCase().includes(term) || (g.description||'').toLowerCase().includes(term));
        bundles = bundles.filter(b => b.name.toLowerCase().includes(term) || (b.games||'').toLowerCase().includes(term));
        document.querySelectorAll(".category-btn").forEach(b => b.classList.remove("active"));
        document.querySelector('[data-category="all"]')?.classList.add("active");
    }

    displayItems(games, bundles);
    }

    /* ---------- 5. RENDER CARDS (MODIFIED) ---------- */
    function displayItems(games = allGames, bundles = allBundles) {
    Object.values(activeTimers).forEach(clearInterval);
    activeTimers = {};

    const menu = document.getElementById("menu-list");
    const items = [
        ...games.map(g => ({...g, type:'game'})),
        ...bundles.map(b => ({...b, type:'bundle'}))
    ];

    menu.innerHTML = items.length
        ? items.map(generateItemCard).join('')
        : `<p style="text-align:center;color:#777;">No items found.</p>`;

    attachCartListeners();
    initializeOfferTimers();
    initializeBundleSwipers();
    attachItemClickListeners(items); 
    }

    /* ---------- 6. CARD HTML (MODIFIED: Added Truncation) ---------- */
    function generateItemCard(item) {
    const isBundle = item.type === 'bundle';
    const price    = isBundle ? parseFloat(item.bundle_price)||0 : parseFloat(item.price)||0;
    let effectiveOffer = parseFloat(item['on offer']) || 0;
    const endTime = item['offer ends']?.trim();
    if (endTime) {
        const parts = endTime.split(' ');
        let datePart = parts[0];
        let timePart = parts.slice(1).join(' ') || '23:59:59';
        // Normalize date
        if (/^\d{4}-\d{2}-\d{2}$/.test(datePart)) {
            // good
        } else if (/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(datePart)) {
            datePart = datePart.replace(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/, '$3-$2-$1');
        } else {
            effectiveOffer = 0;
        }
        // Validate normalized date
        const testDate = new Date(datePart);
        if (isNaN(testDate.getTime())) {
            effectiveOffer = 0;
        }
        // Normalize time: ensure HH:MM:SS
        const timeComponents = timePart.split(':');
        if (timeComponents.length === 2) {
            timePart = `${timeComponents[0].padStart(2,'0')}:${timeComponents[1].padStart(2,'0')}:00`;
        } else if (timeComponents.length === 3) {
            timePart = `${timeComponents[0].padStart(2,'0')}:${timeComponents[1].padStart(2,'0')}:${timeComponents[2].padStart(2,'0')}`;
        } else {
            timePart = '23:59:59';
        }
        const isoString = `${datePart}T${timePart}`;
        const end = new Date(isoString).getTime();
        if (isNaN(end) || end < Date.now()) {
            effectiveOffer = 0;
        }
    }
    const offer    = isBundle ? 0 : effectiveOffer;
    const hasOffer = offer > 0 && offer < price;
    const finalPrice = hasOffer ? offer : price;

    let ribbon = '', priceHTML = '', timer = '';

    if (hasOffer) {
        const save = Math.round(((price - offer) / price) * 100);
        ribbon = `<div class="offer-ribbon">SALE! -${save}%</div>`;
        if (item['offer ends']) {
        timer = `<div class="offer-countdown" data-end-time="${item['offer ends']}">Ends in: <span class="timer-display">...</span></div>`;
        }
        priceHTML = `<p class="price-line sale-mode"><span class="old-price">KSH ${price}</span> <span class="sale-price">KSH ${offer}</span></p>${timer}`;
    } 
    else if (isBundle) {
        ribbon = `<div class="bundle-ribbon">${item.ribbonText}</div>`;
        
        if (item['offer ends']) {
        timer = `<div class="offer-countdown" data-end-time="${item['offer ends']}">Ends in: <span class="timer-display">...</span></div>`;
        }

        priceHTML = `
        <p class="price-line bundle-mode">
            <span class="bundle-old">Worth KSH ${item.total_price}</span>
            <span class="bundle-price">Now KSH ${price}</span>
        </p>
        ${timer}`;
    } 
    else {
        priceHTML = `<p class="price-line"><span class="regular-price">KSH ${price}</span></p>`;
    }

    const firstCat = (item.category || (isBundle ? 'Popular Offers' : 'All')).split(',')[0].trim() || 'All';

    // IMPLEMENT ELLIPSIS FOR CARD DESCRIPTION
    const truncatedDescription = truncateText(item.description || (isBundle ? 'Great value pack!' : 'No description.'), 100);

    return `
        <div class="menu-item fade-in ${isBundle ? 'bundle-card' : ''}" data-category="${firstCat}" data-original-price="${price}">
        ${ribbon}
        ${isBundle ? `
            <div class="bundle-swiper-container">
            <div class="swiper bundle-swiper">
                <div class="swiper-wrapper">
                ${item.allImages.map(img => `
                    <div class="swiper-slide">
                    <img src="${img}" alt="Bundle game" onerror="this.src='https://via.placeholder.com/300?text=Game'">
                    </div>`).join('')}
                </div>
                <div class="swiper-pagination"></div>
            </div>
            </div>
        ` : `
            <img src="${item.image||''}" alt="${item.name}" class="single-image"
                onerror="this.src='https://via.placeholder.com/300?text=${encodeURIComponent(item.name)}'">
        `}
        <h3 class="product-title">${item.name} ${isBundle ? 'Bundle' : ''}</h3>
        ${isBundle ? `<p class="bundle-games">Includes: ${item.games}</p>` : ''}
        <p class="text-card">${truncatedDescription}</p>
        ${priceHTML}
        <button class="add-to-cart" data-name="${item.name}" data-price="${finalPrice}" data-type="${item.type}">
            Add to Cart
        </button>
        </div>`;
    }

    /* ---------- 7. SWIPER FOR BUNDLE IMAGES ---------- */
    function initializeBundleSwipers() {
    document.querySelectorAll('.bundle-swiper').forEach(el => {
        new Swiper(el, {
        loop: true,
        pagination: { el: '.swiper-pagination', clickable: true },
        spaceBetween: 10
        });
    });
    }

    /* ---------- 8. OFFER TIMERS (AUTO-HIDE BUNDLES) ---------- */
    function initializeOfferTimers() {
    document.querySelectorAll('.offer-countdown').forEach(el => {
        const update = () => {
        const raw = el.getAttribute('data-end-time');
        const normalized = raw.replace(/^(\d{1,2})\/(\d{1,2})\/(\d{4})/, '$3-$2-$1');
        const end = new Date(normalized).getTime();
        const now = Date.now();
        const diff = end - now;

        if (isNaN(end) || diff <= 0) {
            const card = el.closest('.menu-item');
            const isBundleCard = card.classList.contains('bundle-card');

            if (isBundleCard) {
            // AUTO-HIDE EXPIRED BUNDLE
            card.style.opacity = '0.3';
            card.style.pointerEvents = 'none';
            card.querySelector('.add-to-cart').disabled = true;
            card.querySelector('.add-to-cart').textContent = 'EXPIRED';
            card.querySelector('.offer-ribbon')?.remove();
            card.querySelector('.price-line').innerHTML = `
                <span class="bundle-old">Worth KSH ${card.getAttribute('data-original-price')}</span>
                <span class="bundle-price">EXPIRED</span>
            `;
            // Add big stamp
            if (!card.querySelector('.expired-stamp')) {
                const stamp = document.createElement('div');
                stamp.className = 'expired-stamp';
                stamp.textContent = 'EXPIRED';
                card.appendChild(stamp);
            }
            } else {
            const price = card.getAttribute('data-original-price');
            card.querySelector('.offer-ribbon')?.remove();
            card.querySelector('.price-line').innerHTML = `<span class="regular-price">KSH ${price}</span>`;
            card.querySelector('.add-to-cart').setAttribute('data-price', price);
            }

            el.remove();
            clearInterval(id);
            delete activeTimers[id];
            return;
        }

        const d = Math.floor(diff/86400000);
        const h = Math.floor((diff%86400000)/3600000);
        const m = Math.floor((diff%3600000)/60000);
        const s = Math.floor((diff%60000)/1000);
        let str = d>0 ? `${d}d ` : '';
        str += `${h.toString().padStart(2,'0')}h:${m.toString().padStart(2,'0')}m:${s.toString().padStart(2,'0')}s`;
        el.querySelector('.timer-display').textContent = str;
        };
        const id = setInterval(update,1000);
        update();
        activeTimers[id] = id;
    });
    }

    /* ---------- 9. CART ---------- */
    function attachCartListeners() {
    document.querySelectorAll(".add-to-cart").forEach(btn => {
        btn.onclick = () => {
        if (btn.disabled) return;
        const name = btn.dataset.name;
        const price = parseFloat(btn.dataset.price);
        const type  = btn.dataset.type;
        const existing = cart.find(i => i.name === name);
        if (existing) existing.quantity++;
        else cart.push({name, price, quantity:1, type});
        localStorage.setItem("cart", JSON.stringify(cart));
        btn.textContent = "Added!";
        setTimeout(() => btn.textContent = "Add to Cart", 1500);
        updateCartBadge();
        };
    });
    }

    /* ----------------------------------------------------------------------------------
    NEW FUNCTIONALITY: GAME DETAIL MODAL
    ---------------------------------------------------------------------------------- */

    function attachItemClickListeners(items) {
        document.querySelectorAll(".menu-item").forEach(card => {
            card.addEventListener('click', (event) => {
                // Prevent opening the modal if the "Add to Cart" button was clicked
                if (event.target.closest('.add-to-cart')) {
                    return;
                }

                // Get the game name from the card title
                const itemName = card.querySelector('.product-title')?.textContent.replace(' Bundle', '').trim();
                const item = items.find(i => i.name === itemName);

                if (item) {
                    showDetailModal(item);
                }
            });
        });
    }

    /* ---------- MODAL HTML (MODIFIED: Swiper structure added) ---------- */
    function generateDetailModalHTML(item) {
        const isBundle = item.type === 'bundle';
        const price = isBundle ? parseFloat(item.bundle_price)||0 : parseFloat(item.price)||0;
        let effectiveOffer = parseFloat(item['on offer']) || 0;
        const endTime = item['offer ends']?.trim();
        if (endTime) {
            const parts = endTime.split(' ');
            let datePart = parts[0];
            let timePart = parts.slice(1).join(' ') || '23:59:59';
            // Normalize date
            if (/^\d{4}-\d{2}-\d{2}$/.test(datePart)) {
                // good
            } else if (/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(datePart)) {
                datePart = datePart.replace(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/, '$3-$2-$1');
            } else {
                effectiveOffer = 0;
            }
            // Validate normalized date
            const testDate = new Date(datePart);
            if (isNaN(testDate.getTime())) {
                effectiveOffer = 0;
            }
            // Normalize time: ensure HH:MM:SS
            const timeComponents = timePart.split(':');
            if (timeComponents.length === 2) {
                timePart = `${timeComponents[0].padStart(2,'0')}:${timeComponents[1].padStart(2,'0')}:00`;
            } else if (timeComponents.length === 3) {
                timePart = `${timeComponents[0].padStart(2,'0')}:${timeComponents[1].padStart(2,'0')}:${timeComponents[2].padStart(2,'0')}`;
            } else {
                timePart = '23:59:59';
            }
            const isoString = `${datePart}T${timePart}`;
            const end = new Date(isoString).getTime();
            if (isNaN(end) || end < Date.now()) {
                effectiveOffer = 0;
            }
        }
        const offer = isBundle ? 0 : effectiveOffer;
        const finalPrice = (offer > 0 && offer < price) ? offer : price;
        const originalPrice = price; 

        let priceHTML = '';
        
        if ((offer > 0 && offer < price)) {
            priceHTML = `<div class="modal-price-line sale-mode"><span class="modal-old-price">KSH ${originalPrice}</span> <span class="modal-sale-price">KSH ${finalPrice}</span> (On Sale!)</div>`;
        } else if (isBundle) {
            priceHTML = `<div class="modal-price-line bundle-mode"><span class="modal-bundle-old">Worth KSH ${item.total_price}</span> <span class="modal-bundle-price">Now KSH ${finalPrice}</span></div>`;
        } else {
            priceHTML = `<div class="modal-price-line"><span class="modal-regular-price">KSH ${finalPrice}</span></div>`;
        }

        const longDescription = item.description || (isBundle ? 'Great value pack!' : 'No detailed description available.');
        const featuredImage = item.image || 'https://via.placeholder.com/600?text=Game+View';


        return `
            <span class="close-btn">&times;</span>
            <div class="modal-flex-container">
                <div class="modal-media-section">
                    ${isBundle ? `
                        <div class="bundle-swiper-container">
                            <div class="swiper bundle-swiper">
                                <div class="swiper-wrapper">
                                ${item.allImages.map(img => `
                                    <div class="swiper-slide">
                                    <img src="${img}" alt="Bundle game view" class="modal-main-image" onerror="this.src='https://via.placeholder.com/600?text=Game+Image'">
                                    </div>`).join('')}
                                </div>
                                <div class="swiper-pagination"></div>
                            </div>
                        </div>
                    ` : `
                        <img src="${featuredImage}" alt="${item.name}" class="modal-main-image"
                            onerror="this.src='https://via.placeholder.com/600?text=${encodeURIComponent(item.name)}'">
                    `}
                </div>
                <div class="modal-details-section">
                    <h2 class="modal-title">${item.name} ${isBundle ? 'Bundle' : ''}</h2>
                    <div class="modal-categories">Category: <strong>${item.category || 'N/A'}</strong></div>
                    
                    <h3 class="modal-subtitle">Details:</h3>
                    <p class="modal-description">${longDescription}</p>

                    ${isBundle ? `<p class="modal-includes">This bundle includes: <strong>${item.games}</strong></p>` : ''}
                    
                    <div class="modal-price-wrapper">
                        ${priceHTML}
                    </div>
                    
                    <button class="add-to-cart modal-add-to-cart-btn" data-name="${item.name}" data-price="${finalPrice}" data-type="${item.type}">
                        Add to Cart
                    </button>
                </div>
            </div>
        `;
    }

    function showDetailModal(item) {
    const modal = document.getElementById('detail-modal');
    const modalContent = document.getElementById('modal-content');

    if (!modal || !modalContent) return;

    // 1. Populate the modal with the item's detailed information
    modalContent.innerHTML = generateDetailModalHTML(item);

    // 2. Display the modal
    modal.style.display = 'block';

    // 3. Re-attach cart listener for the new "Add to Cart" button in the modal
    const modalCartBtn = modalContent.querySelector('.add-to-cart');
    if (modalCartBtn) {
        modalCartBtn.onclick = () => {
            const name = modalCartBtn.dataset.name;
            const price = parseFloat(modalCartBtn.dataset.price);
            const type = modalCartBtn.dataset.type;
            const existing = cart.find(i => i.name === name);
            if (existing) existing.quantity++;
            else cart.push({name, price, quantity:1, type});
            localStorage.setItem("cart", JSON.stringify(cart));
            modalCartBtn.textContent = "Added!";
            setTimeout(() => modalCartBtn.textContent = "Add to Cart", 1500);
            updateCartBadge();
        };
    }

    // 4. Handle modal closing
    const closeBtn = modalContent.querySelector('.close-btn');
    closeBtn?.addEventListener('click', () => {
        modal.style.display = 'none';
    });

    // Handle clicking outside the modal to close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = 'none';
            window.onclick = null; 
        }
    }

    // 5. Re-initialize swiper for bundle images if it's a bundle
    if (item.type === 'bundle') {
        // Increased delay to 100ms to give the browser more time to render images/modal
        // This is crucial for Swiper to calculate slide dimensions correctly.
        setTimeout(() => {
            const swiperEl = modalContent.querySelector('.bundle-swiper');
            if (swiperEl) {
                new Swiper(swiperEl, {
                    loop: true,
                    pagination: { el: '.swiper-pagination', clickable: true },
                    spaceBetween: 10
                });
            }
        }, 100); // ðŸ‘ˆ Change applied here
    }
    }

    /* ----------------------------------------------------------------------------------
    END NEW FUNCTIONALITY
    ---------------------------------------------------------------------------------- */

    function updateCartBadge() {
    const badge = document.querySelector('.cart-badge');
    if (!badge) return;
    const total = cart.reduce((s,i)=>s+i.quantity,0);
    badge.textContent = total;
    badge.classList.toggle('hidden', total===0);
    badge.classList.remove('pulse');
    void badge.offsetWidth;
    if (total>0) badge.classList.add('pulse');
    // At the end of updateCartBadge()
    window.dispatchEvent(new Event('storage')); // Force sync
    }

    /* ---------- 10. GLOBAL EVENTS ---------- */
    window.addEventListener('storage', e => {
    if (e.key==='cart') { cart = JSON.parse(e.newValue)||[]; updateCartBadge(); }
    });
    document.addEventListener('DOMContentLoaded', () => {
    cart = JSON.parse(localStorage.getItem("cart"))||[];
    updateCartBadge();
    });


    </script>


    <!-- âœ… FORMSPREE + GOOGLE SHEETS CONTACT FORM -->

<script>
  document.querySelector('.contact-form')?.addEventListener('submit', async function(e) {
    const form = e.target;
    const webhook = form.dataset.sheetWebhook;
    if (!webhook) return;

    e.preventDefault(); // Stop default submit

    const data = new FormData(form);

    try {
      // Send to Google Sheets
      await fetch(webhook, { method: 'POST', body: data });
    } catch (err) {
      console.error('Failed to save to Google Sheets:', err);
      // Still continue to Formspree even if Sheets fails
    }

    // Now submit to Formspree
    const formspreeAction = form.action;
    const formspreeData = new FormData(form);

    fetch(formspreeAction, {
      method: 'POST',
      body: formspreeData,
      headers: { 'Accept': 'application/json' }
    })
    .then(response => {
      if (response.ok) {
        // SUCCESS: Clear the form
        form.reset();

        // Optional: Show a nice message
        const submitBtn = form.querySelector('.submit-button');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'Sent! Thank you';
        submitBtn.style.background = '#e7c725';
        setTimeout(() => {
          submitBtn.textContent = originalText;
          submitBtn.style.background = '';
        }, 3000);
      } else {
        alert('Something went wrong. Please try again.');
      }
    })
    .catch(() => {
      alert('Network error. Please check your connection.');
    });
  });
</script>



    <script src="Mumbi script.js"></script>
  </body>
</html>




